
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>50a23bb7</title>
  <meta name="author" content="zellux">
  <meta name="Generator" content="Jekyll & Octopress (http://octopress.org)">

  
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://tech.yxwang.me/">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/octopress.min.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="50a23bb7" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-25551121-3']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


   
  <link href="/octopress-favicon.png" rel="icon">
</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">50a23bb7</a></h1>
  
    <h2>Everyday coding notes</h2>
  
  <div class="clear"></div>
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:tech.yxwang.me" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/archives">Archives</a></li>
  <li><a href="/about">About</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
    










    <article >
      
  <header>
    <h1 class="entry-title">

<a href="/2012/12/traps-in-comparing-container-sizes/">Traps in Comparing Container Sizes</a>

</h1>

    
      <p class="meta">
        








  


<time datetime="2012-12-06T15:28:00+08:00" pubdate data-updated="true">Dec 6<span>th</span>, 2012</time>
         &bull; <a rel="bookmark" href="/2012/12/traps-in-comparing-container-sizes/">Permalink</a>
      </p>
    
  </header>

<div class="entry-content"><p>I just started learning C++ and occurred a bug related with container size comparison.</p>

<p>The following code looks ok from Java or Ruby&#8217;s perspective:</p>

<figure class='code'><div class='highlight'><table><td class='gutter'><pre class='line-numbers'><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="k">while</span> <span class="p">(</span><span class="n">front</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">-</span> <span class="n">back</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">back</span><span class="p">.</span><span class="n">insert</span><span class="p">(</span><span class="o">*</span><span class="n">front</span><span class="p">.</span><span class="n">rbegin</span><span class="p">());</span>
</span><span class='line'>    <span class="n">front</span><span class="p">.</span><span class="n">erase</span><span class="p">(</span><span class="o">--</span><span class="n">front</span><span class="p">.</span><span class="n">end</span><span class="p">());</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>However, there is a critical bug in this code. <code>size()</code> method returns a value in <code>size_type</code>, which is an unsigned integer. If front.size() is smaller than back.size(), the minus will underflow and result in a very large value, thus making the while loop condition true.</p>

<p>Knowing the reason, it is easy to correct this loop condition as follows:</p>

<figure class='code'><div class='highlight'><table><td class='gutter'><pre class='line-numbers'><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="k">while</span> <span class="p">(</span><span class="n">front</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">&gt;</span> <span class="n">back</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">back</span><span class="p">.</span><span class="n">insert</span><span class="p">(</span><span class="o">*</span><span class="n">front</span><span class="p">.</span><span class="n">rbegin</span><span class="p">());</span>
</span><span class='line'>    <span class="n">front</span><span class="p">.</span><span class="n">erase</span><span class="p">(</span><span class="o">--</span><span class="n">front</span><span class="p">.</span><span class="n">end</span><span class="p">());</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>



</div>

  <footer>
    
    
  </footer>


    </article>
  
    










    <article >
      
  <header>
    <h1 class="entry-title">

<a href="/2012/09/useful-methods-in-kaminari/">Useful Methods in Kaminari</a>

</h1>

    
      <p class="meta">
        








  


<time datetime="2012-09-09T23:18:00+08:00" pubdate data-updated="true">Sep 9<span>th</span>, 2012</time>
         &bull; <a rel="bookmark" href="/2012/09/useful-methods-in-kaminari/">Permalink</a>
      </p>
    
  </header>

<div class="entry-content"><p>The famous Rails paginator
<a href="https://github.com/amatsuda/kaminari/">Kaminari</a> provides some
methods in query objects, which may be useful for customizing
views. They are not listed on the document, you may find them in
<a href="https://github.com/amatsuda/kaminari/blob/master/lib/kaminari/models/page_scope_methods.rb">lib/kaminari/models/page_scope_methods.rb</a>:</p>

<ul>
<li>total_pages (alias num_pages)</li>
<li>current_page</li>
<li>first_page?</li>
<li>last_page?</li>
</ul>


<p>Method names are intuitive enough to show what the method returns.</p>
</div>

  <footer>
    
    
  </footer>


    </article>
  
    










    <article >
      
  <header>
    <h1 class="entry-title">

<a href="/2012/08/notes-of-algorithms-course-week-1/">Successor With Delete</a>

</h1>

    
      <p class="meta">
        








  


<time datetime="2012-08-30T10:05:00+08:00" pubdate data-updated="true">Aug 30<span>th</span>, 2012</time>
         &bull; <a rel="bookmark" href="/2012/08/notes-of-algorithms-course-week-1/">Permalink</a>
      </p>
    
  </header>

<div class="entry-content"><h2>Problem</h2>

<p>Given a set of N integers S={0,1,&#8230;,N−1} and a sequence of requests of the following form:</p>

<ul>
<li>Remove x from S</li>
<li>Find the successor of x: the smallest y in S such that y≥x.</li>
</ul>


<p>design a data type so that all operations (except construction) should take logarithmic time or better.</p>

<h2>Solution</h2>

<p>This is a problem taken from the interview questions in union-find set on <a href="https://class.coursera.org/algs4partI-2012-001/quiz/attempt?quiz_id=89">Coursea Algorithms Course</a>.</p>

<p>It would be much harder if posted to the interviewee without context of union-find set. Fortunately we now known it can be solved with union-find set.</p>

<p>The results of finding the successor of x are saved in union-find sets, that is, when finding the successor of x, we simply return the root of the set containing x. When removing x from S, we need to make successor of removed numbers consequent to x and before x as that of x + 1. This is exactly what union function needs to do. To remove x from S, we simply merge the set containing x to the set containing x + 1 (append as its child).</p>

<p>This will work for both removing and finding except that in worst cases it does not run in logarithmic time, since it does not consider set weight when merging two sets. To opmitize this, our merging function will work in a way similar to weighted quick union, except that if the numbers in the larger set are smaller than that in the smaller one, we need to change the root of unioned set to the root of the larger set. This can be done by changing the original root of the two sets. Then we make ensure logarithmic time in worst case.</p>
</div>

  <footer>
    
    
  </footer>


    </article>
  
    










    <article >
      
  <header>
    <h1 class="entry-title">

<a href="/2012/08/solution-to-clrs-chapter-32/">Solutions to CLRS Chapter 32.1</a>

</h1>

    
      <p class="meta">
        








  


<time datetime="2012-08-22T22:22:00+08:00" pubdate data-updated="true">Aug 22<span>nd</span>, 2012</time>
         &bull; <a rel="bookmark" href="/2012/08/solution-to-clrs-chapter-32/">Permalink</a>
      </p>
    
  </header>

<div class="entry-content"><h2>Problem 32.1-2</h2>

<blockquote><p>Suppose that all characters in the pattern P are different. Show how to accelerate NAIVE-STRING-MATCHER to run in time O(n) on an n-character text T .</p></blockquote>

<p>When T[i] and P[j] mismatches in NAIVE-STRING-MATCHER, we can skip all characters before T[i] and begin new matching from T[i + 1] with P[1].</p>

<h2>Problem 32.1-4</h2>

<blockquote><p>  Suppose we allow the pattern P to contain occurrences of a gap character ◇ that can match an arbitrary string of characters (even one of zero length). Note that the gap character may occur an arbitrary number of times in the pattern but not at all in the text. Give a polynomial-time algorithm to determine whether such a pattern P occurs in a given text T , and analyze the running time of your algorithm.</p></blockquote>

<p>We can solve this problem using dynamic programming. Assume we have function F(T<sub>i</sub>, P<sub>j</sub>), which defines whether the subpattern P<sub>j</sub> matches T<sub>i</sub>, and its value can be deducted from three sub-problems:</p>

<ol>
<li>P[j] == ◇ AND F(T<sub>i-1</sub>, P<sub>j</sub>)</li>
<li>P[j] == ◇ AND F(T<sub>i</sub>, P<sub>j-1</sub>)</li>
<li>F(T<sub>i-1</sub>, P<sub>j-1</sub>)</li>
</ol>


<p>F(T<sub>i</sub>, P<sub>j</sub>) is true, if and only if any of the above statements is true. The problem can thus be sovled in O(n ^ 2) in a bottom-up way.</p>
</div>

  <footer>
    
    
  </footer>


    </article>
  
    










    <article >
      
  <header>
    <h1 class="entry-title">

<a href="/2012/08/order-of-different-formats-in-response-to-does-matter/">Order of Formats in Response_to Does Matter</a>

</h1>

    
      <p class="meta">
        








  


<time datetime="2012-08-17T19:48:00+08:00" pubdate data-updated="true">Aug 17<span>th</span>, 2012</time>
         &bull; <a rel="bookmark" href="/2012/08/order-of-different-formats-in-response-to-does-matter/">Permalink</a>
      </p>
    
  </header>

<div class="entry-content"><p>The following code snippet works well for most browsers:</p>

<figure class='code'><div class='highlight'><table><td class='gutter'><pre class='line-numbers'><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">respond_to</span> <span class="k">do</span> <span class="o">|</span><span class="nb">format</span><span class="o">|</span>
</span><span class='line'>  <span class="nb">format</span><span class="o">.</span><span class="n">json</span> <span class="p">{</span> <span class="n">blah</span> <span class="n">blah</span> <span class="p">}</span>
</span><span class='line'>  <span class="nb">format</span><span class="o">.</span><span class="n">html</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>But some browsers, especially embedded webkit components, may set ContentType to <code>*/*</code> in request headers. In this case, they will get JSON data instead of HTML if they do not explicitly specify .html format in URL.</p>

<p>So as long as it is not intended, putting format.html before format.json will always be a better choice.</p>
</div>

  <footer>
    
    
  </footer>


    </article>
  
    










    <article >
      
  <header>
    <h1 class="entry-title">

<a href="/2012/06/adding-missing-content-length-to-send-file-headers/">Adding Content-Length to Send_file Headers</a>

</h1>

    
      <p class="meta">
        








  


<time datetime="2012-06-18T19:52:00+08:00" pubdate data-updated="true">Jun 18<span>th</span>, 2012</time>
         &bull; <a rel="bookmark" href="/2012/06/adding-missing-content-length-to-send-file-headers/">Permalink</a>
      </p>
    
  </header>

<div class="entry-content"><p>Some clients and networking libraries may expect &#8216;Content-Length&#8217; in response headers when downloading files. However, this parameter is not provided in Rails send_file method. To add content size to the header, you may just add a line next to the send_file method:</p>

<figure class='code'><div class='highlight'><table><td class='gutter'><pre class='line-numbers'><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">def</span> <span class="nf">download</span>
</span><span class='line'>    <span class="n">filename</span> <span class="o">=</span> <span class="n">params</span><span class="o">[</span><span class="ss">:name</span><span class="o">]</span>
</span><span class='line'>    <span class="n">send_file</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
</span><span class='line'>    <span class="n">headers</span><span class="o">[</span><span class="s1">&#39;Content-Length&#39;</span><span class="o">]</span> <span class="o">=</span> <span class="no">File</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>



</div>

  <footer>
    
    
  </footer>


    </article>
  
    










    <article >
      
  <header>
    <h1 class="entry-title">

<a href="/2012/05/some-notes-on-rspec/">Some Notes on RSpec</a>

</h1>

    
      <p class="meta">
        








  


<time datetime="2012-05-07T15:40:00+08:00" pubdate data-updated="true">May 7<span>th</span>, 2012</time>
         &bull; <a rel="bookmark" href="/2012/05/some-notes-on-rspec/">Permalink</a>
      </p>
    
  </header>

<div class="entry-content"><h3>Stubbing instance methods</h3>

<p>The method <code>any_instance</code> allows stubbing instance methods easily. For example, the following line will force calling Item#price to return 10 always:</p>

<figure class='code'><div class='highlight'><table><td class='gutter'><pre class='line-numbers'><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">Item</span><span class="o">.</span><span class="n">any_instance</span><span class="o">.</span><span class="n">stub</span><span class="p">(</span><span class="ss">:price</span><span class="p">)</span><span class="o">.</span><span class="n">and_return</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<h3>Stubbing in helper specs</h3>

<p>Stubbing in helper specs is similar to stubbing in controller specs. Just remember to add <code>helper.</code> before every helper method call.</p>

<figure class='code'><div class='highlight'><table><td class='gutter'><pre class='line-numbers'><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">it</span> <span class="s1">&#39;test current user&#39;</span> <span class="k">do</span>
</span><span class='line'>  <span class="n">helper</span><span class="o">.</span><span class="n">stub</span><span class="p">(</span><span class="ss">:current_user</span><span class="p">)</span><span class="o">.</span><span class="n">and_return</span><span class="p">(</span><span class="n">user</span><span class="p">)</span>
</span><span class='line'>  <span class="n">helper</span><span class="o">.</span><span class="n">user_avatar</span><span class="o">.</span><span class="n">should_not</span> <span class="n">be_empty</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<h3>let and let!</h3>

<p>Variables defined by <code>let</code> is evaluated in a lazy way. Use <code>let!</code> to force the evaluation before each spec.</p>
</div>

  <footer>
    
    
  </footer>


    </article>
  
    










    <article >
      
  <header>
    <h1 class="entry-title">

<a href="/2012/03/speeding-up-string-concatenation-in-ruby/">Speeding Up String Concatenation in Ruby</a>

</h1>

    
      <p class="meta">
        








  


<time datetime="2012-03-30T16:31:00+08:00" pubdate data-updated="true">Mar 30<span>th</span>, 2012</time>
         &bull; <a rel="bookmark" href="/2012/03/speeding-up-string-concatenation-in-ruby/">Permalink</a>
      </p>
    
  </header>

<div class="entry-content"><p>When concatenation large chunks of strings in Ruby, operator <code>&lt;&lt;</code> will be more efficient than <code>+</code>. This is because <code>+</code> creates immutable strings and introduces burden on garbage collector, while <code>&lt;&lt;</code> mutates the orinal string and thus do not create new objects.</p>
</div>

  <footer>
    
    
  </footer>


    </article>
  
    










    <article >
      
  <header>
    <h1 class="entry-title">

<a href="/2012/03/optimizing-page-rendering-speed-for-ipad-3/">Optimizing Page Rendering Speed for iPad 3</a>

</h1>

    
      <p class="meta">
        








  


<time datetime="2012-03-27T18:16:00+08:00" pubdate data-updated="true">Mar 27<span>th</span>, 2012</time>
         &bull; <a rel="bookmark" href="/2012/03/optimizing-page-rendering-speed-for-ipad-3/">Permalink</a>
      </p>
    
  </header>

<div class="entry-content"><p>When developing online book store in <a href="http://tangcha.tc">Tangcha</a>, we were confronted with slow web page rendering issue on iPad 3, and finally found out two optimizations to make it much faster. The approaches were also posted on <a href="http://stackoverflow.com/a/10721238/111896">Stack Overflow</a>.</p>

<ol>
<li><p>Avoid using CSS3 effects. We used a lot of CSS3 shadows in previous versions, which slowed down rendering process on iPad 3 a lot. After replacing those shadow effects with background images, performance got greatly improved on iPad 3.</p></li>
<li><p>Optimize Javascript. Our application has some scrollable components, whenever user scrolls the component some Javascript code will be executed to do some loading work, like loading images in a lazy way. On iPad 3 scrolling will delay for 500ms when user tries to scroll from one page to the next. Then we found some unnecessary image loading work were performed in the scrolling callback, after removing them, the scrolling performance is acceptable.</p></li>
</ol>

</div>

  <footer>
    
    
  </footer>


    </article>
  
    










    <article >
      
  <header>
    <h1 class="entry-title">

<a href="/2012/03/finding-out-the-encoding-of-a-mysql-database/">Finding Out the Encoding of a MySQL Database</a>

</h1>

    
      <p class="meta">
        








  


<time datetime="2012-03-23T09:45:00+08:00" pubdate data-updated="true">Mar 23<span>rd</span>, 2012</time>
         &bull; <a rel="bookmark" href="/2012/03/finding-out-the-encoding-of-a-mysql-database/">Permalink</a>
      </p>
    
  </header>

<div class="entry-content"><p>Find out the encoding of a MySQL database:</p>

<figure class='code'><div class='highlight'><table><td class='gutter'><pre class='line-numbers'><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='plain'><span class='line'>SHOW VARIABLES LIKE 'character_set_%';</span></code></pre></td></tr></table></div></figure>


<p>Find out the encoding of a specific table:</p>

<figure class='code'><div class='highlight'><table><td class='gutter'><pre class='line-numbers'><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='plain'><span class='line'>SHOW CREATE TABLE table_name;</span></code></pre></td></tr></table></div></figure>



</div>

  <footer>
    
    
  </footer>


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/blog/page/2/">&larr; Older</a>
    
    <a href="/archives">Blog Archives</a>
    
  </div>
</div>

<aside class="sidebar">
  
    
<section>
  <h1>Latest Tweets</h1>
  <ul id="tweets" data-user="zellux" data-count="5" data-replies="false">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  
    <a href="//twitter.com/zellux" class="twitter-follow-button" data-show-count="false">Follow @zellux</a>
  
</section>





<section>
  <h1>On GitHub</h1>
  <ul id="gh_repos" data-user="zellux" data-count="5" data-skip="true">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  
  <a class="github-follow" href="https://github.com/zellux">Follow @zellux</a>
  
</section>








  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2012 - zellux -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = '50a23bb7';
			var disqus_developer = '0';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>






</body>
</html>
